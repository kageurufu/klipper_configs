[gcode_macro SQUARE]
gcode:
    {% if 'xy' not in printer.toolhead.homed_axes %}
        G28 XY
    {% endif %}
    
    {% set inset = params.INSET | default(5) | int %}
    {% for _ in range(0, params.COUNT | default(1) | int) %}
        G0 X{printer.toolhead.axis_minimum[0] + inset} Y{printer.toolhead.axis_minimum[1] + inset}
        G0 X{printer.toolhead.axis_maximum[0] - inset} Y{printer.toolhead.axis_minimum[1] + inset}
        G0 X{printer.toolhead.axis_maximum[0] - inset} Y{printer.toolhead.axis_maximum[1] - inset}
        G0 X{printer.toolhead.axis_minimum[0] + inset} Y{printer.toolhead.axis_maximum[1] - inset}
    {% endfor %}