[neopixel chamber_lights]
chain_count: 132
initial_RED: 0
initial_GREEN: 0
initial_BLUE: 0
initial_WHITE: 0.25
color_order: GRBW


[gcode_macro set_all_leds]
gcode:
    {% set LED = params.LED | default("chamber_lights") %}
    {% set RED = params.RED | default(0.0) | float %}
    {% set GREEN = params.GREEN | default(0.0) | float %}
    {% set BLUE = params.BLUE | default(0.0) | float %}
    {% set WHITE = params.WHITE | default(0.0) | float %}

    SET_LED LED={LED} RED={RED} GREEN={GREEN} BLUE={BLUE} WHITE={WHITE} TRANSMIT=1


[gcode_macro SET_LED_HSI]
gcode:
    {% set __builtins__ = action_respond_info.__func__.__globals__['__builtins__'] %}
    {% set __import__ = __builtins__.__import__ %}
    {% set colorsys = __import__('colorsys') %}

    {% set HUE = params.HUE | default(0) | int %}
    {% set SAT = params.SATURATION | default(0) | float %}
    {% set INT = params.INTENSITY | default(0) | float %}
    
    {% set (RED, GREEN, BLUE) = colorsys.hls_to_rgb((HUE | float) / 360.0, INT, SAT) %}

    {% set WHITE = 0 %}
    {% if printer['neopixel {}'.format(params.LED)].color_data[params.INDEX | default(0) | int] | count == 4 %}
        {% set WHITE = (RED, GREEN, BLUE) | min %}
        {% set RED = RED - WHITE %}
        {% set BLUE = BLUE - WHITE %}
        {% set GREEN = GREEN - WHITE %}
    {% endif %}

    SET_LED LED={params.LED} RED={RED} GREEN={GREEN} BLUE={BLUE} {% if WHITE %} WHITE={WHITE} {% endif %}
        {%- if params.INDEX %} INDEX={params.INDEX} {% endif %}
        {%- if params.TRANSMIT %} TRANSMIT={params.TRANSMIT} {% endif %}
        {%- if params.SYNC %} SYNC={params.SYNC} {% endif %}